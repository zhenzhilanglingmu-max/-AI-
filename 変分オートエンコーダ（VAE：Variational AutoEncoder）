# 🧠 変分オートエンコーダ（VAE：Variational AutoEncoder）

## 概要
**変分オートエンコーダ（VAE：Variational AutoEncoder）** は、  
入力データを「確率的な潜在表現」に変換し、  
小さく圧縮しながら再生成（デコード）できる**生成モデル**。  

通常のオートエンコーダ（AE）は、入力→圧縮→再構成を行うだけやけど、  
VAEは**潜在変数 z を確率分布（平均 μ と分散 σ²）**で扱うのが特徴。  
これにより、似た特徴を持つ新しいデータも生成できるようになる。

---

## 🔧 基本構造と流れ

1. **Encoder（エンコーダ）**  
　入力データ（画像・音声・テキストなど）を、  
　潜在変数 z の**平均 μ** と **分散 σ²** に変換する。  

2. **Sampling（サンプリング）**  
　その μ と σ からランダムに潜在変数 z を生成。  
　このとき直接サンプリングすると勾配が流れにくくなるので、  
　**再パラメータ化トリック（Reparameterization Trick）** を使って  
　勾配計算を可能にする。  
　```
　z = μ + σ * ε　（ε ~ N(0, 1)）
　```

3. **Decoder（デコーダ）**  
　z から元のデータを再構成する。  
　このとき、VAEは「再現しつつ、生成もできる」ように学習する。

---

## 🎯 損失関数（Loss Function）

VAEでは、出力のズレや潜在空間のゆがみを補正するために、  
2つの損失を組み合わせる：

### ① 再構成誤差（Reconstruction Loss）
出力（再構成されたデータ）が、元の入力にどれだけ近いかを測る。  
例：画像なら二乗誤差や交差エントロピーなど。
L_rec = || x - x' ||²

👉 「見た目のズレ」を修正する役割。

---

### ② KLダイバージェンス（KL Divergence）
潜在変数 z の分布 q(z|x) が、標準正規分布 p(z) にどれだけ近いかを測る。
L_KL = D_KL(q(z|x) || p(z))

👉 「潜在空間のゆがみ」を補正する役割。

---

### ⚖️ 最終的な損失の式
L_total = L_rec + β * L_KL

- **再構成誤差**：出力を正確にする  
- **KLダイバージェンス**：潜在空間を整える  
- **β（ベータ）**：生成と再構成のバランスを調整  

βを大きくすると生成の滑らかさが上がる（β-VAE）。

---

## 🌍 マルチモーダルへの応用

VAEは画像だけでなく、**音声・テキスト・医療データ・時系列信号**など、  
あらゆるデータに応用できる。  
さらに、「複数のモード（モダリティ）」を扱う**マルチモーダルVAE（MMVAE）**も存在する。

### 🧩 マルチモーダルVAEの考え方
それぞれのモダリティをVAEのエンコーダで処理し、  
**共通の潜在空間 z** にマッピングする。
画像 → Encoder_img ┐
　　　　　　　 　↓
　　　　　　　 z_shared ← Encoder_text ← テキスト
　　　　　　　　　　　↑
　　　　　　Decoder_img / Decoder_text

これにより：
- 画像からテキストを生成（Image → Text）
- テキストから画像を生成（Text → Image）
- 音声とテキストの統合（Speech ↔ Text）

といった**マルチモーダル変換**が可能になる。

---

## 🧠 VAEとマルチモーダルの関係

| 比較項目 | 変分オートエンコーダ（VAE） | マルチモーダル学習 |
|-----------|---------------------------|--------------------|
| 主な目的 | データを生成・再構成する | 異なるモードを統合・対応づける |
| 入力 | 1種類（例：画像） | 複数種類（例：画像＋テキスト） |
| 出力 | 同種のデータを再構成 | 異種間の生成・理解 |
| 潜在空間 | 確率的な連続表現 | モダリティ間の共通表現 |
| 応用例 | 画像生成、異常検知 | 画像キャプション生成、CLIP など |

---

## 💬 まとめ

| 要素 | 内容 |
|------|------|
| Encoder | 入力を確率分布（μ, σ²）に変換 |
| Reparameterization | 確率的サンプリングを微分可能にする |
| Decoder | 潜在変数からデータを再構成 |
| 再構成誤差 | 出力のズレ補正 |
| KLダイバージェンス | 潜在空間の正規化 |
| βパラメータ | 生成と再構成のバランス調整 |
| 応用 | 画像生成・異常検知・マルチモーダル変換 |

---

## 🔑 キーワード
- バリエーショナル・オートエンコーダ（Variational AutoEncoder）  
- 潜在変数（Latent Variable）  
- 再パラメータ化トリック（Reparameterization Trick）  
- 再構成誤差（Reconstruction Loss）  
- KLダイバージェンス（KL Divergence）  
- β-VAE  
- マルチモーダルVAE（MMVAE）

---




